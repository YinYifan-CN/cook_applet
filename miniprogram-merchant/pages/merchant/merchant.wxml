<!--pages/merchant/merchant.wxml-->
<view class="container">
  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stat-card">
      <view class="stat-value">{{totalOrders}}</view>
      <view class="stat-label">æ€»è®¢å•</view>
    </view>
    <view class="stat-card stat-pending">
      <view class="stat-value">{{pendingOrders}}</view>
      <view class="stat-label">å¾…å¤„ç†</view>
    </view>
    <view class="stat-card stat-revenue">
      <view class="stat-value">Â¥{{totalRevenue}}</view>
      <view class="stat-label">æ€»æ”¶å…¥</view>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <scroll-view class="filter-bar" scroll-x>
    <view class="filter-btn {{statusFilter === 'all' ? 'active' : ''}}" bindtap="filterOrders" data-status="all">
      å…¨éƒ¨è®¢å•
    </view>
    <view class="filter-btn {{statusFilter === 'pending' ? 'active' : ''}}" bindtap="filterOrders" data-status="pending">
      å¾…æ¥å•
    </view>
    <view class="filter-btn {{statusFilter === 'accepted' ? 'active' : ''}}" bindtap="filterOrders" data-status="accepted">
      å·²æ¥å•
    </view>
    <view class="filter-btn {{statusFilter === 'preparing' ? 'active' : ''}}" bindtap="filterOrders" data-status="preparing">
      åˆ¶ä½œä¸­
    </view>
    <view class="filter-btn {{statusFilter === 'completed' ? 'active' : ''}}" bindtap="filterOrders" data-status="completed">
      å·²å®Œæˆ
    </view>
    <view class="filter-btn {{statusFilter === 'cancelled' ? 'active' : ''}}" bindtap="filterOrders" data-status="cancelled">
      å·²å–æ¶ˆ
    </view>
  </scroll-view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="orders-list">
    <view class="order-card" wx:for="{{filteredOrders}}" wx:key="id">
      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-info">
          <view class="order-number">è®¢å•å·: {{item.id}}</view>
          <view class="order-meta">
            <text>é¡¾å®¢: {{item.user_name}}</text>
            <text class="order-time">{{item.createdAtFormatted}}</text>
          </view>
        </view>
        <view class="order-status" style="background: {{statusColors[item.status]}}">
          {{statusMap[item.status]}}
        </view>
      </view>

      <!-- è®¢å•é¡¹ -->
      <view class="order-items">
        <view class="order-item" wx:for="{{item.items}}" wx:key="dish_id" wx:for-item="dish">
          <text class="item-name">{{dish.dish_name}}</text>
          <text class="item-quantity">x{{dish.quantity}}</text>
          <text class="item-price">Â¥{{dish.priceFormatted}}</text>
        </view>
      </view>

      <!-- å¤‡æ³¨ -->
      <view class="order-note" wx:if="{{item.note}}">
        ğŸ“ å¤‡æ³¨: {{item.note}}
      </view>

      <!-- æ€»ä»· -->
      <view class="order-total">
        åˆè®¡: Â¥{{item.totalAmountFormatted}}
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="order-actions">
        <!-- å¾…æ¥å•çŠ¶æ€ -->
        <block wx:if="{{item.status === 'pending'}}">
          <button class="action-btn btn-accept" bindtap="acceptOrder" data-id="{{item.id}}">âœ… æ¥å•</button>
          <button class="action-btn btn-cancel" bindtap="cancelOrder" data-id="{{item.id}}">âŒ æ‹’ç»</button>
        </block>

        <!-- å·²æ¥å•çŠ¶æ€ -->
        <block wx:if="{{item.status === 'accepted'}}">
          <button class="action-btn btn-start" bindtap="startPreparing" data-id="{{item.id}}">ğŸ‘¨â€ğŸ³ å¼€å§‹åˆ¶ä½œ</button>
          <button class="action-btn btn-detail" bindtap="viewOrderDetail" data-id="{{item.id}}">ğŸ“‹ æŸ¥çœ‹è¯¦æƒ…</button>
        </block>

        <!-- åˆ¶ä½œä¸­çŠ¶æ€ -->
        <block wx:if="{{item.status === 'preparing'}}">
          <button class="action-btn btn-complete" bindtap="completeOrder" data-id="{{item.id}}">âœ”ï¸ å®Œæˆ</button>
          <button class="action-btn btn-detail" bindtap="viewOrderDetail" data-id="{{item.id}}">ğŸ“‹ æŸ¥çœ‹è¯¦æƒ…</button>
        </block>

        <!-- å·²å®Œæˆ/å·²å–æ¶ˆçŠ¶æ€ -->
        <block wx:if="{{item.status === 'completed' || item.status === 'cancelled'}}">
          <button class="action-btn btn-detail" bindtap="viewOrderDetail" data-id="{{item.id}}">ğŸ“‹ æŸ¥çœ‹è¯¦æƒ…</button>
        </block>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredOrders.length === 0}}">
      <view class="empty-icon">ğŸ“­</view>
      <view class="empty-text">æš‚æ— è®¢å•</view>
    </view>
  </view>
</view>
