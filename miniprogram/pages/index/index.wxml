<!--pages/index/index.wxml-->
<wxs module="utils">
  var toFixed = function(num, digits) {
    return Number(num).toFixed(digits || 2);
  };
  module.exports.toFixed = toFixed;
</wxs>

<view class="container">
  <!-- èœå“åˆ—è¡¨ -->
  <view class="dish-list">
    <view class="dish-card" wx:for="{{dishes}}" wx:key="id">
      <view class="dish-info" bindtap="viewDishDetail" data-dish="{{item}}">
        <view class="dish-name">{{item.name}}</view>
        <view class="dish-desc">{{item.description}}</view>
        <view class="dish-price">Â¥{{item.price}}</view>
      </view>
      <view class="dish-actions">
        <button class="btn-add" bindtap="addToCart" data-dish="{{item}}">
          â™¥ æ”¶è—
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{dishes.length === 0}}">
    <view class="empty-state-icon">ğŸ½ï¸</view>
    <view class="empty-state-text">æš‚æ— èœå“</view>
  </view>

  <!-- æ”¶è—æµ®åŠ¨æŒ‰é’® -->
  <view class="cart-float" wx:if="{{cart.length > 0}}" bindtap="showCart">
    <view class="cart-badge">{{getCartCount()}}</view>
    <view class="cart-icon">â™¥</view>
    <view class="cart-total">Â¥{{getCartTotal()}}</view>
  </view>

  <!-- æ”¶è—å¼¹çª— -->
  <view class="cart-popup" wx:if="{{showCartPopup}}">
    <view class="cart-mask" bindtap="hideCart"></view>
    <view class="cart-content">
      <view class="cart-header">
        <text>æˆ‘çš„æ”¶è—</text>
        <text bindtap="hideCart">âœ•</text>
      </view>
      <scroll-view class="cart-items" scroll-y>
        <view class="cart-item" wx:for="{{cart}}" wx:key="dish_id">
          <view class="item-name">{{item.dish_name}}</view>
          <view class="item-controls">
            <button class="btn-minus" bindtap="decreaseQuantity" data-dish-id="{{item.dish_id}}">-</button>
            <text class="item-quantity">{{item.quantity}}</text>
            <button class="btn-plus" bindtap="addToCart" data-dish="{{item}}">+</button>
          </view>
          <view class="item-price">Â¥{{utils.toFixed(item.price * item.quantity, 2)}}</view>
        </view>
      </scroll-view>
      <view class="cart-footer">
        <view class="footer-total">å‚è€ƒä»·ï¼šÂ¥{{getCartTotal()}}</view>
        <button class="btn-checkout" bindtap="goToCheckout">æŸ¥çœ‹è¯¦æƒ…</button>
      </view>
    </view>
  </view>
</view>
