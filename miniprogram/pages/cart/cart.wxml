<!--pages/cart/cart.wxml-->
<wxs module="utils">
  var toFixed = function(num, digits) {
    return Number(num).toFixed(digits || 2);
  };
  module.exports.toFixed = toFixed;
</wxs>

<view class="container">
  <!-- 收藏列表 -->
  <view class="cart-list" wx:if="{{cart.length > 0}}">
    <view class="cart-item" wx:for="{{cart}}" wx:key="dish_id">
      <view class="item-info">
        <view class="item-name">{{item.dish_name}}</view>
        <view class="item-price">¥{{item.price}}</view>
      </view>
      <view class="item-controls">
        <button class="btn-minus" bindtap="decreaseQuantity" data-dish-id="{{item.dish_id}}">-</button>
        <text class="item-quantity">{{item.quantity}}</text>
        <button class="btn-plus" bindtap="increaseQuantity" data-dish-id="{{item.dish_id}}">+</button>
      </view>
      <view class="item-total">¥{{utils.toFixed(item.price * item.quantity, 2)}}</view>
    </view>
  </view>

  <!-- 空购物车状态 -->
  <view class="empty-state" wx:else>
    <view class="empty-state-icon">♥</view>
    <view class="empty-state-text">还没有收藏的菜谱</view>
    <button class="btn-go-shopping" bindtap="goToIndex">去浏览菜谱</button>
  </view>

  <!-- 备注 -->
  <view class="note-section" wx:if="{{cart.length > 0}}">
    <view class="section-title">备注信息</view>
    <textarea 
      class="note-input" 
      placeholder="有什么特殊要求吗？（选填）" 
      value="{{note}}"
      bindinput="onNoteInput"
      maxlength="200"
    />
  </view>

  <!-- 底部结算栏 -->
  <view class="checkout-bar" wx:if="{{cart.length > 0}}">
    <view class="checkout-info">
      <view class="total-label">参考价格</view>
      <view class="total-price">¥{{getTotalPrice()}}</view>
    </view>
    <button class="btn-submit" bindtap="submitOrder">确认清单</button>
  </view>

  <!-- 清空收藏按钮 -->
  <view class="clear-cart" wx:if="{{cart.length > 0}}">
    <button class="btn-clear" bindtap="clearCart">清空收藏</button>
  </view>
</view>
