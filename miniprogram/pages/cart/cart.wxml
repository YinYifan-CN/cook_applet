<!--pages/cart/cart.wxml-->
<wxs module="utils">
  var toFixed = function(num, digits) {
    return Number(num).toFixed(digits || 2);
  };
  module.exports.toFixed = toFixed;
</wxs>

<view class="container">
  <!-- è´­ç‰©è½¦å•†å“åˆ—è¡¨ -->
  <view class="cart-list" wx:if="{{cart.length > 0}}">
    <view class="cart-item" wx:for="{{cart}}" wx:key="dish_id">
      <view class="item-info">
        <view class="item-name">{{item.dish_name}}</view>
        <view class="item-price">Â¥{{item.price}}</view>
      </view>
      <view class="item-controls">
        <button class="btn-minus" bindtap="decreaseQuantity" data-dish-id="{{item.dish_id}}">-</button>
        <text class="item-quantity">{{item.quantity}}</text>
        <button class="btn-plus" bindtap="increaseQuantity" data-dish-id="{{item.dish_id}}">+</button>
      </view>
      <view class="item-total">Â¥{{utils.toFixed(item.price * item.quantity, 2)}}</view>
    </view>
  </view>

  <!-- ç©ºè´­ç‰©è½¦çŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-state-icon">ğŸ›’</view>
    <view class="empty-state-text">è´­ç‰©è½¦æ˜¯ç©ºçš„</view>
    <button class="btn-go-shopping" bindtap="goToIndex">å»ç‚¹é¤</button>
  </view>

  <!-- å¤‡æ³¨ -->
  <view class="note-section" wx:if="{{cart.length > 0}}">
    <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
    <textarea 
      class="note-input" 
      placeholder="æœ‰ä»€ä¹ˆç‰¹æ®Šè¦æ±‚å—ï¼Ÿï¼ˆé€‰å¡«ï¼‰" 
      value="{{note}}"
      bindinput="onNoteInput"
      maxlength="200"
    />
  </view>

  <!-- åº•éƒ¨ç»“ç®—æ  -->
  <view class="checkout-bar" wx:if="{{cart.length > 0}}">
    <view class="checkout-info">
      <view class="total-label">æ€»è®¡</view>
      <view class="total-price">Â¥{{getTotalPrice()}}</view>
    </view>
    <button class="btn-submit" bindtap="submitOrder">æäº¤è®¢å•</button>
  </view>

  <!-- æ¸…ç©ºè´­ç‰©è½¦æŒ‰é’® -->
  <view class="clear-cart" wx:if="{{cart.length > 0}}">
    <button class="btn-clear" bindtap="clearCart">æ¸…ç©ºè´­ç‰©è½¦</button>
  </view>
</view>
