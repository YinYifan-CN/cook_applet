# ğŸš€ é¦™é¦™å¨æˆ¿ç‚¹èœç³»ç»Ÿ - æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å°†ç‚¹èœç³»ç»Ÿéƒ¨ç½²åˆ°LinuxæœåŠ¡å™¨ï¼ˆå¦‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰ã€‚

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### 1. æœåŠ¡å™¨è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 7+ / Debian 10+
- **å†…å­˜**: è‡³å°‘ 1GB RAM
- **å­˜å‚¨**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´
- **Python**: 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬

### 2. å¼€æ”¾ç«¯å£
ç¡®ä¿æœåŠ¡å™¨å®‰å…¨ç»„/é˜²ç«å¢™å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
- **8000**: APIæœåŠ¡ç«¯å£ï¼ˆå¯åœ¨ config.py ä¸­ä¿®æ”¹ï¼‰
- **80**: HTTPï¼ˆå¦‚æœéœ€è¦ï¼‰
- **443**: HTTPSï¼ˆå¦‚æœéœ€è¦ï¼‰

---

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤1: è¿æ¥åˆ°æœåŠ¡å™¨

ä½¿ç”¨SSHè¿æ¥åˆ°ä½ çš„æœåŠ¡å™¨ï¼š

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
# æˆ–
ssh ç”¨æˆ·å@ä½ çš„æœåŠ¡å™¨IP
```

### æ­¥éª¤2: å®‰è£…å¿…è¦è½¯ä»¶

#### Ubuntu/Debian:
```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£…Python 3å’Œpip
sudo apt install -y python3 python3-pip python3-venv

# å®‰è£…Gitï¼ˆç”¨äºä¸Šä¼ ä»£ç ï¼‰
sudo apt install -y git

# å®‰è£…screenæˆ–supervisorï¼ˆç”¨äºåå°è¿è¡Œï¼‰
sudo apt install -y screen
```

#### CentOS:
```bash
# å®‰è£…Python 3
sudo yum install -y python3 python3-pip

# å®‰è£…Git
sudo yum install -y git

# å®‰è£…screen
sudo yum install -y screen
```

### æ­¥éª¤3: ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨

æœ‰3ç§æ–¹å¼ä¸Šä¼ ä»£ç ï¼š

#### æ–¹å¼1: ä½¿ç”¨Gitï¼ˆæ¨èï¼‰
```bash
# å¦‚æœä½ çš„ä»£ç åœ¨GitHub/Giteeä¸Š
cd /home
git clone https://github.com/ä½ çš„ç”¨æˆ·å/cook_applet.git
cd cook_applet
```

#### æ–¹å¼2: ä½¿ç”¨SCPä¸Šä¼ 
åœ¨**æœ¬åœ°ç”µè„‘**çš„PowerShellä¸­è¿è¡Œï¼š
```powershell
# æ‰“åŒ…é¡¹ç›®ï¼ˆæ’é™¤è™šæ‹Ÿç¯å¢ƒï¼‰
cd D:\MyCode\cook_applet
tar -czf cook_applet.tar.gz --exclude=aenv --exclude=__pycache__ .

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp cook_applet.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/home/

# åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
ssh root@ä½ çš„æœåŠ¡å™¨IP
cd /home
mkdir cook_applet
tar -xzf cook_applet.tar.gz -C cook_applet
cd cook_applet
```

#### æ–¹å¼3: ä½¿ç”¨FTPå·¥å…·
ä½¿ç”¨FileZillaã€WinSCPç­‰å·¥å…·ï¼Œå°†é¡¹ç›®æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ `/home/cook_applet` ç›®å½•ã€‚

### æ­¥éª¤4: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/cook_applet

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv aenv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source aenv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å‡çº§pipï¼ˆå¯é€‰ï¼‰
pip install --upgrade pip
```

### æ­¥éª¤5: é…ç½®æ•°æ®åº“

```bash
# åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
python database.py

# å¯¼å…¥ç¤ºä¾‹èœå“æ•°æ®
python init_data.py
```

### æ­¥éª¤6: ä¿®æ”¹é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.py`ï¼Œå°†æœåŠ¡å™¨åœ°å€æ”¹ä¸ºå¯¹å¤–è®¿é—®ï¼š

```bash
nano config.py
# æˆ–
vi config.py
```

ä¿®æ”¹å†…å®¹ï¼š
```python
# æœåŠ¡å™¨é…ç½®
SERVER_HOST = "0.0.0.0"  # å…è®¸å¤–éƒ¨è®¿é—®
SERVER_PORT = 8000       # ç«¯å£å·

# æ•°æ®åº“é…ç½®
DATABASE_URL = "sqlite:///./cook_applet.db"

# å¾®ä¿¡å°ç¨‹åºé…ç½®ï¼ˆå¦‚æœæœ‰çš„è¯ï¼Œå¡«å†™çœŸå®å€¼ï¼‰
WECHAT_APP_ID = "ä½ çš„å¾®ä¿¡å°ç¨‹åºAppID"
WECHAT_APP_SECRET = "ä½ çš„å¾®ä¿¡å°ç¨‹åºAppSecret"
```

### æ­¥éª¤7: æµ‹è¯•è¿è¡Œ

å…ˆæµ‹è¯•ä¸€ä¸‹æ˜¯å¦èƒ½æ­£å¸¸å¯åŠ¨ï¼š

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source aenv/bin/activate

# å¯åŠ¨æœåŠ¡
python Cook_applet.py
```

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼š
```
ç‚¹èœç³»ç»ŸAPIå¯åŠ¨æˆåŠŸï¼
==================================================
ğŸ“± ç”¨æˆ·ç«¯é¡µé¢: http://localhost:8000/demo.html
ğŸª å•†å®¶ç«¯é¡µé¢: http://localhost:8000/merchant.html
ğŸ“– APIæ–‡æ¡£: http://localhost:8000/docs
ğŸ”Œ WebSocket: ws://localhost:8000/ws/merchant
```

åœ¨æµè§ˆå™¨è®¿é—®ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8000/docs` æµ‹è¯•æ˜¯å¦èƒ½è®¿é—®ã€‚

æµ‹è¯•æˆåŠŸåï¼ŒæŒ‰ `Ctrl+C` åœæ­¢æœåŠ¡ã€‚

---

## ğŸŒ åå°è¿è¡ŒæœåŠ¡

### æ–¹å¼1: ä½¿ç”¨ Screenï¼ˆç®€å•æ¨èï¼‰

```bash
# åˆ›å»ºä¸€ä¸ªåä¸ºcookçš„screenä¼šè¯
screen -S cook

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶å¯åŠ¨æœåŠ¡
cd /home/cook_applet
source aenv/bin/activate
python Cook_applet.py

# æŒ‰ Ctrl+A ç„¶åæŒ‰ D ç¦»å¼€screenï¼ˆæœåŠ¡ç»§ç»­è¿è¡Œï¼‰

# æŸ¥çœ‹æ‰€æœ‰screenä¼šè¯
screen -ls

# é‡æ–°è¿›å…¥screenä¼šè¯
screen -r cook

# åœæ­¢æœåŠ¡ï¼šè¿›å…¥screenåæŒ‰ Ctrl+C

# åˆ é™¤screenä¼šè¯
screen -X -S cook quit
```

### æ–¹å¼2: ä½¿ç”¨ nohup

```bash
cd /home/cook_applet
source aenv/bin/activate

# åå°è¿è¡Œï¼Œæ—¥å¿—è¾“å‡ºåˆ° cook_applet.log
nohup python Cook_applet.py > cook_applet.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f cook_applet.log

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep Cook_applet

# åœæ­¢æœåŠ¡
kill -9 è¿›ç¨‹ID
```

### æ–¹å¼3: ä½¿ç”¨ Systemdï¼ˆç”Ÿäº§æ¨èï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ï¼š

```bash
sudo nano /etc/systemd/system/cook-applet.service
```

å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=Cook Applet API Service
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=/home/cook_applet
Environment="PATH=/home/cook_applet/aenv/bin"
ExecStart=/home/cook_applet/aenv/bin/python /home/cook_applet/Cook_applet.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
# é‡æ–°åŠ è½½systemdé…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start cook-applet

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status cook-applet

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable cook-applet

# åœæ­¢æœåŠ¡
sudo systemctl stop cook-applet

# é‡å¯æœåŠ¡
sudo systemctl restart cook-applet

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u cook-applet -f
```

---

## ğŸ”’ é…ç½®é˜²ç«å¢™

### Ubuntu (UFW):
```bash
# å…è®¸8000ç«¯å£
sudo ufw allow 8000/tcp

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

### CentOS (Firewalld):
```bash
# å…è®¸8000ç«¯å£
sudo firewall-cmd --permanent --add-port=8000/tcp
sudo firewall-cmd --reload

# æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£
sudo firewall-cmd --list-ports
```

### äº‘æœåŠ¡å™¨å®‰å…¨ç»„
ä¸è¦å¿˜è®°åœ¨äº‘æœåŠ¡å•†æ§åˆ¶å°ï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ç­‰ï¼‰çš„**å®‰å…¨ç»„è§„åˆ™**ä¸­å¼€æ”¾ 8000 ç«¯å£ã€‚

---

## ğŸŒ åŸŸåå’Œåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ æœ‰åŸŸåï¼Œå¯ä»¥ä½¿ç”¨ Nginx åšåå‘ä»£ç†ï¼Œå®ç°ï¼š
- ä½¿ç”¨ 80/443 ç«¯å£è®¿é—®
- é…ç½® HTTPS
- è´Ÿè½½å‡è¡¡

### å®‰è£… Nginx

```bash
sudo apt install -y nginx  # Ubuntu
# æˆ–
sudo yum install -y nginx  # CentOS
```

### é…ç½®åå‘ä»£ç†

åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/nginx/sites-available/cook-applet
```

å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```nginx
server {
    listen 80;
    server_name ä½ çš„åŸŸå.com;  # æ”¹æˆä½ çš„åŸŸåæˆ–æœåŠ¡å™¨IP

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # WebSocketæ”¯æŒ
    location /ws/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }
}
```

å¯ç”¨é…ç½®ï¼š

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/cook-applet /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

ç°åœ¨å¯ä»¥é€šè¿‡ `http://ä½ çš„åŸŸå.com` è®¿é—®äº†ï¼

---

## ğŸ“± å°ç¨‹åºé…ç½®

ä¿®æ”¹å°ç¨‹åºçš„APIåœ°å€ï¼š

### ç”¨æˆ·ç«¯å°ç¨‹åº
ç¼–è¾‘ `miniprogram/utils/api.js`ï¼š

```javascript
const BASE_URL = 'http://ä½ çš„æœåŠ¡å™¨IP:8000'
// æˆ–ä½¿ç”¨åŸŸå
const BASE_URL = 'http://ä½ çš„åŸŸå.com'
```

### å•†å®¶ç«¯å°ç¨‹åº
ç¼–è¾‘ `miniprogram-merchant/utils/api.js`ï¼š

```javascript
const BASE_URL = 'http://ä½ çš„æœåŠ¡å™¨IP:8000'
// æˆ–ä½¿ç”¨åŸŸå
const BASE_URL = 'http://ä½ çš„åŸŸå.com'
```

**æ³¨æ„**: å¾®ä¿¡å°ç¨‹åºè¦æ±‚ä½¿ç”¨ HTTPSï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®SSLè¯ä¹¦ã€‚

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ— æ³•è®¿é—®æœåŠ¡å™¨

```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
ps aux | grep Cook_applet

# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tulpn | grep 8000
# æˆ–
ss -tulpn | grep 8000

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status  # Ubuntu
sudo firewall-cmd --list-all  # CentOS
```

### 2. ä¾èµ–å®‰è£…å¤±è´¥

```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 3. æƒé™é—®é¢˜

```bash
# ç»™å¯åŠ¨è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™
chmod +x start.sh restart.sh

# ç¡®ä¿æ•°æ®åº“æ–‡ä»¶æœ‰å†™æƒé™
chmod 666 cook_applet.db
```

### 4. æŸ¥çœ‹æ—¥å¿—

```bash
# å¦‚æœä½¿ç”¨systemd
sudo journalctl -u cook-applet -f

# å¦‚æœä½¿ç”¨screen
screen -r cook

# å¦‚æœä½¿ç”¨nohup
tail -f cook_applet.log
```

### 5. æ•°æ®åº“é”å®šé—®é¢˜

```bash
# SQLiteæ•°æ®åº“è¢«é”å®šæ—¶
rm cook_applet.db
python database.py
python init_data.py
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

å½“ä»£ç æœ‰æ›´æ–°æ—¶ï¼š

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/cook_applet

# å¦‚æœç”¨Git
git pull

# å¦‚æœæ‰‹åŠ¨ä¸Šä¼ ï¼Œç”¨æ–°æ–‡ä»¶æ›¿æ¢

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source aenv/bin/activate

# æ›´æ–°ä¾èµ–ï¼ˆå¦‚æœæœ‰æ–°ä¾èµ–ï¼‰
pip install -r requirements.txt

# é‡å¯æœåŠ¡
# æ–¹å¼1: screen
screen -r cook
# æŒ‰Ctrl+Cåœæ­¢ï¼Œç„¶åé‡æ–°è¿è¡Œ python Cook_applet.py

# æ–¹å¼2: systemd
sudo systemctl restart cook-applet

# æ–¹å¼3: æ‰‹åŠ¨killè¿›ç¨‹
ps aux | grep Cook_applet
kill -9 è¿›ç¨‹ID
python Cook_applet.py &
```

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨

```bash
# CPUå’Œå†…å­˜ä½¿ç”¨
top
# æˆ–
htop

# ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
du -h cook_applet.db
```

### å®šæœŸå¤‡ä»½æ•°æ®åº“

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
nano backup.sh
```

```bash
#!/bin/bash
# å¤‡ä»½æ•°æ®åº“
BACKUP_DIR="/home/cook_applet/backups"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR
cp /home/cook_applet/cook_applet.db $BACKUP_DIR/cook_applet_$DATE.db

# åªä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "cook_applet_*.db" -mtime +7 -delete

echo "å¤‡ä»½å®Œæˆ: cook_applet_$DATE.db"
```

```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x backup.sh

# è®¾ç½®å®šæ—¶ä»»åŠ¡
crontab -e

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /home/cook_applet/backup.sh
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å·²å®‰è£… Python 3.8+
- [ ] å·²å¼€æ”¾ 8000 ç«¯å£ï¼ˆå®‰å…¨ç»„+é˜²ç«å¢™ï¼‰
- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»ºå¹¶æ¿€æ´»
- [ ] ä¾èµ–å·²å®‰è£…å®Œæˆ
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] config.py å·²é…ç½®æ­£ç¡®
- [ ] æœåŠ¡èƒ½æ­£å¸¸å¯åŠ¨
- [ ] å¯é€šè¿‡IPè®¿é—®APIæ–‡æ¡£
- [ ] å·²é…ç½®åå°è¿è¡Œï¼ˆscreen/systemd/nohupï¼‰
- [ ] å°ç¨‹åºAPIåœ°å€å·²ä¿®æ”¹
- [ ] ï¼ˆå¯é€‰ï¼‰Nginxåå‘ä»£ç†å·²é…ç½®
- [ ] ï¼ˆå¯é€‰ï¼‰åŸŸåå·²è§£æ
- [ ] ï¼ˆå¯é€‰ï¼‰HTTPSè¯ä¹¦å·²é…ç½®

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼ä½ çš„ç‚¹èœç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²åˆ°æœåŠ¡å™¨ã€‚

**è®¿é—®åœ°å€ï¼š**
- APIæ–‡æ¡£: `http://ä½ çš„æœåŠ¡å™¨IP:8000/docs`
- ç”¨æˆ·ç«¯: `http://ä½ çš„æœåŠ¡å™¨IP:8000/demo.html`
- å•†å®¶ç«¯: `http://ä½ çš„æœåŠ¡å™¨IP:8000/merchant.html`

**ä¸‹ä¸€æ­¥ï¼š**
1. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸
2. é…ç½®å¾®ä¿¡å°ç¨‹åºAppIDå’ŒAppSecret
3. ä¿®æ”¹å°ç¨‹åºAPIåœ°å€å¹¶é‡æ–°ä¸Šä¼ 
4. ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰é…ç½®HTTPSå’ŒåŸŸå

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æˆ–å‚è€ƒå¸¸è§é—®é¢˜æ’æŸ¥éƒ¨åˆ†ã€‚

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼ğŸ³**
