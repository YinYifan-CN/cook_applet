# 微信小程序使用指南（用户端+商家端分离版）

## 📱 项目说明

本项目现在包含**两个独立的小程序**：

1. **用户端小程序** - `miniprogram/` 目录
   - 功能：浏览菜品、点餐、购物车、查看订单
   
2. **商家端小程序** - `miniprogram-merchant/` 目录  
   - 功能：订单管理、菜品管理、查看制作说明

---

## 🚀 快速开始

### 1️⃣ 确保后端运行

后端服务必须在运行中：
```powershell
# 在项目根目录
.\aenv\Scripts\Activate.ps1
python .\Cook_applet.py
```

服务运行在：`http://192.168.70.209:8000`

### 2️⃣ 导入用户端小程序

1. 打开微信开发者工具
2. 选择"导入项目"
3. 项目目录：`d:\MyCode\cook_applet\miniprogram`
4. AppID：选择"测试号"（或使用你的AppID）
5. 项目名称：香香厨房-用户端

### 3️⃣ 导入商家端小程序

**在新的微信开发者工具窗口中：**

1. 打开微信开发者工具（新窗口或新标签页）
2. 选择"导入项目"  
3. 项目目录：`d:\MyCode\cook_applet\miniprogram-merchant`
4. AppID：选择"测试号"（或使用你的AppID）
5. 项目名称：香香厨房-商家端

### 4️⃣ 配置开发者工具

**两个小程序都需要做这个配置：**

1. 点击右上角"详情"
2. 选择"本地设置"
3. ✅ 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
4. ✅ 勾选"不校验安全域名"

### 5️⃣ 编译运行

- 点击"编译"按钮即可在模拟器中查看
- 点击"预览"生成二维码，手机扫码真机测试

---

## 📱 两个小程序的区别

### 👤 用户端小程序（miniprogram）

**底部导航栏：**
- 🍽️ 点餐 - 浏览菜品并下单
- 🛒 购物车 - 查看和管理购物车
- 📋 我的订单 - 查看订单历史和状态

**主要功能：**
- 浏览所有可用菜品
- 添加菜品到购物车
- 下单并填写备注
- 查看订单状态（待接单、已接单、制作中、已完成）

### 🏪 商家端小程序（miniprogram-merchant）

**底部导航栏：**
- 📋 订单管理 - 处理客户订单
- 🍽️ 菜品管理 - 管理菜品库

**订单管理功能：**
- 实时查看新订单
- 接单/拒绝订单
- 开始制作
- 查看菜品制作说明（重要！）
- 完成订单
- 订单筛选（按状态）
- 统计数据（总订单、待处理、总收入）

**菜品管理功能：**
- 查看所有菜品
- 添加新菜品（含制作说明）
- 编辑菜品信息
- 上架/下架菜品
- 删除菜品

---

## 🔄 完整使用流程

### 用户下单流程：

1. **用户端**：打开"点餐"页面
2. 浏览菜品，点击"加入购物车"
3. 点击底部购物车查看
4. 点击"去结算"
5. 填写备注（可选）
6. 提交订单
7. 在"我的订单"中查看订单状态

### 商家接单流程：

1. **商家端**：打开"订单管理"页面
2. 看到新订单提示（待接单）
3. 点击"✅ 接单"确认接单
4. 点击"📋 查看详情"查看订单和制作说明
5. 点击"👨‍🍳 开始制作"
6. 按照制作说明制作菜品
7. 完成后点击"✔️ 完成"
8. 订单状态自动更新到用户端

---

## 📋 制作说明功能

这是商家端的核心功能，帮助厨师标准化制作流程。

### 在添加菜品时填写制作说明：

建议格式：
```
食材：
- 主料1
- 主料2

调料：
- 调料1
- 调料2

步骤：
1. 第一步操作
2. 第二步操作
3. 第三步操作
```

### 在订单中查看制作说明：

1. 订单列表中点击"📋 查看详情"
2. 每个菜品下方会显示制作说明
3. 点击展开即可查看完整步骤

---

## 🌐 网络配置说明

### 当前配置：

两个小程序都使用同一个后端API：
```
http://192.168.70.209:8000
```

### 如果需要修改IP地址：

**用户端**：修改 `miniprogram/utils/api.js` 和 `miniprogram/app.js`

**商家端**：修改 `miniprogram-merchant/utils/api.js` 和 `miniprogram-merchant/app.js`

### 查看本机IP：
```powershell
ipconfig | Select-String "192.168"
```

---

## 🎯 项目目录结构

```
cook_applet/
├── miniprogram/              # 用户端小程序
│   ├── app.js
│   ├── app.json
│   ├── pages/
│   │   ├── index/           # 点餐页面
│   │   ├── cart/            # 购物车
│   │   └── order/           # 订单列表
│   └── utils/
│       └── api.js           # 用户端API
│
├── miniprogram-merchant/     # 商家端小程序
│   ├── app.js
│   ├── app.json
│   ├── pages/
│   │   ├── merchant/        # 订单管理
│   │   ├── dish-list/       # 菜品列表
│   │   └── add-dish/        # 添加/编辑菜品
│   └── utils/
│       └── api.js           # 商家端API
│
├── Cook_applet.py            # 后端服务
├── database.py               # 数据库
└── cook_applet.db            # SQLite数据库文件
```

---

## ⚠️ 常见问题

### Q1: 小程序显示"请求失败"
**解决方案：**
1. 确认后端服务正在运行
2. 确认手机和电脑在同一WiFi
3. 检查微信开发者工具是否关闭了域名校验
4. 尝试重新编译小程序

### Q2: 订单状态不更新
**解决方案：**
- 用户端：下拉刷新订单页面
- 商家端：下拉刷新订单列表
- 或者等待30秒自动刷新

### Q3: 看不到制作说明
**解决方案：**
1. 确保在添加菜品时填写了制作说明
2. 在商家端"订单管理"中点击"查看详情"
3. 制作说明在每个菜品详情下方

### Q4: 如何同时测试两个小程序？
**方法1：开两个微信开发者工具窗口**
- 一个打开用户端
- 另一个打开商家端

**方法2：一个用模拟器，一个用真机**
- 用户端用模拟器
- 商家端扫码用手机测试（或反过来）

---

## 🎨 界面说明

### 用户端主题色：
- 主色：粉红色 (#ff6b9d)
- 风格：温馨、友好

### 商家端主题色：
- 主色：紫蓝色 (#667eea)
- 风格：专业、高效

---

## 📝 开发注意事项

1. **两个小程序是完全独立的**
   - 代码不共享（各有自己的utils/api.js）
   - 可以独立发布
   - 可以有不同的AppID

2. **共用同一个后端**
   - 都连接到同一个API服务器
   - 数据库是共享的

3. **真机测试要求**
   - 手机必须和电脑在同一WiFi
   - 两个小程序都可以同时在手机上测试

4. **生产环境部署**
   - 需要部署后端到有https的服务器
   - 两个小程序都需要配置合法域名
   - 可以作为两个独立的小程序发布

---

## 🚀 下一步

现在你可以：
1. ✅ 在微信开发者工具中分别打开两个小程序
2. ✅ 用用户端下单测试
3. ✅ 用商家端接单并查看制作说明
4. ✅ 体验完整的订单流程

**祝你使用愉快！** 🎉
